<div class="layui-form" lay-filter="layuiadmin-app-form-list" id="layuiadmin-app-form-list" style="margin:3px;padding:20px;background-color: #fff;">
    <div style="height:25px;"></div>
    <div class="layui-container">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-sm9 layui-col-xs9">
                <fieldset class="layui-elem-field box-top">
                    <legend>分类信息 <font color="#ccc"></font></legend>
                    <div class="layui-field-box">
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">所属分类</label>
                                <div class="layui-input-block">
                                    <select name="category_id" xm-select="select1" xm-select-show-count="3">
                                        {$data['category_list']|raw}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="layui-elem-field box-top">
                    <legend>基本信息 <font color="#ccc"></font></legend>
                    <div class="layui-field-box">
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <label class="layui-form-label">文章标题</label>
                                <div class="layui-input-block">
                                    <input type="text" name="title" lay-verify="required" autocomplete="off" placeholder="请输入文章标题" class="layui-input" value="{$data['title']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">作者</label>
                                <div class="layui-input-block" style="max-width:150px;">
                                    <input type="text" name="author" lay-verify="" autocomplete="off" placeholder="请输入作者" class="layui-input" value="{$data['author']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">关键词</label>
                                <div class="layui-input-block">
                                    <input type="text" name="keywords" autocomplete="off" placeholder="请输入SEO关键词" class="layui-input" value="{$data['keywords']}">
                                    <p class="layui-word-aux">多关键词之间用英文逗号隔开</p>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">来源媒体</label>
                                <div class="layui-input-block" style="max-width: 150px;">
                                    <input type="text" name="source_name" autocomplete="off" placeholder="请输入来源媒体名称" class="layui-input" value="{$data['source_name']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">来源地址</label>
                                <div class="layui-input-block">
                                    <input type="text" name="source_url" autocomplete="off" placeholder="请输入文章来源地址" class="layui-input" value="{$data['source_url']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">文章摘要</label>
                                <div class="layui-input-block">
                                    <textarea name="description" placeholder="请输入文章摘要" class="layui-textarea">{$data['description']}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="layui-elem-field box-top">
                    <legend>文章内容 <font color="#ccc"></font></legend>
                    <div class="layui-field-box">
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <textarea name="content" id="content" placeholder="请输入文章内容" style="width: 100%; height: 400px;">
                                    {$data['content']|raw}
                                </textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="layui-col-sm3 layui-col-xs3">
                <fieldset class="layui-elem-field sm">
                    <legend>缩略图 <font color="#ccc"></font></legend>
                    <div class="layui-field-box sm">
                        <div class="layui-row">
                            <div class="layui-form-item" style="text-align: center;">
                                <img src="{$data['image_url']|default='/static/admin/style/images/default-thumbnail.png'}" id="upload-thumbnail" data-type="thumb" width="80%">
                                <input type="hidden" name="image_url" value="{$data['image_url']}" class="image_value">
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="layui-elem-field sm">
                    <legend>发布时间 <font color="#ccc"></font></legend>
                    <div class="layui-field-box">
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <input type="text" name="published_time" class="layui-input" placeholder="发布时间" value="{:date('Y-m-d H:i:s', $data['published_time'])}">
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset class="layui-elem-field sm">
                    <legend>发布状态 <font color="#ccc"></font></legend>
                    <div class="layui-field-box">
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <input type="checkbox" name="status" value="1" title="发布" lay-skin="primary" {$data['status']?'checked':''}>
                            </div>
                            <div class="layui-form-item">
                                <input type="checkbox" name="hot" value="1" title="热门" lay-skin="primary" {$data['hot']?'checked':''}>
                            </div>
                            <!--<div class="layui-form-item">-->
                                <!--<input type="checkbox" name="top" value="1" title="置顶" lay-skin="primary" {$data['top']?'checked':''}>-->
                            <!--</div>-->
                            <div class="layui-form-item">
                                <input type="checkbox" name="recommended" value="1" title="推荐" lay-skin="primary" {$data['recommended']?'checked':''}>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="layui-elem-field sm">
                    <legend>设置评论 <font color="#ccc"></font></legend>
                    <div class="layui-field-box">
                        <div class="layui-row">
                            <div class="layui-form-item">
                                <input type="radio" name="comment_status" value="1" title="允许评论" {$data['comment_status']==1?'checked':''}>
                            </div>
                            <div class="layui-form-item">
                                <input type="radio" name="comment_status" value="0" title="不许评论" {$data['comment_status']==0?'checked':''}>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="layui-form-item layui-hide">
            <input type="hidden" name="id" value="{$data['id']}">
            <button class="layui-btn" lay-submit="" id="layuiadmin-app-form-submit" lay-filter="layuiadmin-app-form-submit">立即提交</button>
            <button id="getContent">设置编辑器内容</button>
        </div>
    </div>


    <script src="__EXTEND__/ueditors/ueditor.config.js?v=1.9.6"></script>
    <script src="__EXTEND__/ueditors/ueditor.all.min.js?v=1.9.6"></script>
    <script>
        bodyD.use(['index','form','laydate','upload','formSelects'], function () {
            var $ = layui.$,
                laydate = layui.laydate,
                upload = layui.upload,
                formSelects = layui.formSelects;

            //分类下拉
            formSelects.btns('select1', ['select', 'remove'], {show: 'name'});
            //发布时间
            laydate.render({
                elem: 'input[name="published_time"]',
                type: 'datetime',
            });
            //上传缩略图
            uploadImages($('#upload-thumbnail'));

            var ue = UE.getEditor('content', {
                serverUrl: "{:url('PortalNews/upDetailsImages',['type'=>'content'])}",
                enableAutoSave: false,
                saveInterval: 1000 * 3600,
                enableContextMenu: false,
                autoHeightEnabled: false,
            });

            $("#getContent").click('click', function () {
                //console.log(ue.getContent());
                $('textarea[name="content"]').val(ue.getContent());
            });

            //上传图
            function uploadImages(uploadName, label) {
                var type = uploadName.data('type');
                var oUrl = '{:url("PortalNews/uploadImage",["type"=>"__type__"])}';
                //上传头像
                upload.render({
                    elem: uploadName
                    , url: oUrl.replace('__type__', type)
                    , accept: 'file' //普通文件
                    , exts: 'jpg|jpeg|png|gif' //只允许上传压缩文件
                    , before: function (obj) { //obj参数包含的信息，跟 choose回调完全一致，可参见上文。
                        layer.load(); //上传loading
                    }
                    , done: function (res) {
                        layer.closeAll('loading');
                        var item = this.item;
                        if(res.code == 0) {
                            //console.log(label);
                            if (label == undefined) {
                                item.attr('src', res.data.file);
                                item.siblings('input.image_value').val(res.data.file);
                            }
                            return false;
                        }
                        layer.msg(res.msg, {icon:0});
                    }
                    , error: function () {
                        layer.msg('上传错误！', {icon: 0});
                    }
                });
            }
        });
    </script>